// RequestAnimFrame: a browser API for getting smooth animations
function Platform(){this.width=70;this.height=17;this.x=Math.random()*(width-this.width);this.y=position;position+=height/platformCount;this.flag=0;this.state=0;this.cx=0;this.cy=0;this.cwidth=105;this.cheight=31;this.draw=function(){try{this.type==1?this.cy=0:this.type==2?this.cy=61:this.type==3&&this.flag===0?this.cy=31:this.type==3&&this.flag==1?this.cy=1e3:this.type==4&&this.state===0?this.cy=90:this.type==4&&this.state==1&&(this.cy=1e3);ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(e){}};score>=5e3?this.types=[2,3,3,3,4,4,4,4]:score>=2e3&&score<5e3?this.types=[2,2,2,3,3,3,3,4,4,4,4]:score>=1e3&&score<2e3?this.types=[2,2,2,3,3,3,3,3]:score>=500&&score<1e3?this.types=[1,1,1,1,1,2,2,2,2,3,3,3,3]:score>=100&&score<500?this.types=[1,1,1,1,2,2]:this.types=[1];this.type=this.types[Math.floor(Math.random()*this.types.length)];if(this.type==3&&broken<1)broken++;else if(this.type==3&&broken>=1){this.type=1;broken=0}this.moved=0;this.vx=1}function init(){function n(){ctx.clearRect(0,0,width,height)}function r(){if(e=="left"){player.dir="left";player.vy<-7&&player.vy>-15&&(player.dir="left_land")}else if(e=="right"){player.dir="right";player.vy<-7&&player.vy>-15&&(player.dir="right_land")}document.onkeydown=function(t){var n=t.keyCode;if(n==37){e="left";player.isMovingLeft=!0}else if(n==39){e="right";player.isMovingRight=!0}n==32&&(firstRun===!0?init():reset())};document.onkeyup=function(t){var n=t.keyCode;if(n==37){e="left";player.isMovingLeft=!1}else if(n==39){e="right";player.isMovingRight=!1}};if(player.isMovingLeft===!0){player.x+=player.vx;player.vx-=.15}else{player.x+=player.vx;player.vx<0&&(player.vx+=.1)}if(player.isMovingRight===!0){player.x+=player.vx;player.vx+=.15}else{player.x+=player.vx;player.vx>0&&(player.vx-=.1)}player.vx>8?player.vx=8:player.vx<-8&&(player.vx=-8);player.y+player.height>base.y&&base.y<height&&player.jump();base.y>height&&player.y+player.height>height&&player.isDead!="lol"&&(player.isDead=!0);player.x>width?player.x=0-player.width:player.x<0-player.width&&(player.x=width);if(player.y>=height/2-player.height/2){player.y+=player.vy;player.vy+=gravity}else{platforms.forEach(function(e,t){player.vy<0&&(e.y-=player.vy);if(e.y>height){platforms[t]=new Platform;platforms[t].y=e.y-height}});base.y-=player.vy;player.vy+=gravity;if(player.vy>=0){player.y+=player.vy;player.vy+=gravity}score++}o();player.isDead===!0&&a()}function i(){var e=Spring,t=platforms[0];if(t.type==1||t.type==2){e.x=t.x+t.width/2-e.width/2;e.y=t.y-t.height-10;e.y>height/1.1&&(e.state=0);e.draw()}else{e.x=0-e.width;e.y=0-e.height}}function s(){var e=platform_broken_substitute;platforms.forEach(function(n,r){if(n.type==2){if(n.x<0||n.x+n.width>width)n.vx*=-1;n.x+=n.vx}if(n.flag==1&&e.appearance===!1&&t===0){e.x=n.x;e.y=n.y;e.appearance=!0;t++}n.draw()});if(e.appearance===!0){e.draw();e.y+=8}e.y>height&&(e.appearance=!1)}function o(){platforms.forEach(function(e,n){if(player.vy>0&&e.state===0&&player.x+15<e.x+e.width&&player.x+player.width-15>e.x&&player.y+player.height>e.y&&player.y+player.height<e.y+e.height){if(e.type==3&&e.flag===0){e.flag=1;t=0;return}if(e.type==4&&e.state===0){player.jump();e.state=1}else{if(e.flag==1)return;player.jump()}}});var e=Spring;if(player.vy>0&&e.state===0&&player.x+15<e.x+e.width&&player.x+player.width-15>e.x&&player.y+player.height>e.y&&player.y+player.height<e.y+e.height){e.state=1;player.jumpHigh()}}function u(){var e=document.getElementById("score");e.innerHTML=score}function a(){platforms.forEach(function(e,t){e.y-=12});if(player.y>height/2&&flag===0){player.y-=8;player.vy=0}else if(player.y<height/2)flag=1;else if(player.y+player.height>height){showGoMenu();hideScore();player.isDead="lol";var e=document.getElementById("tweetBtn");e.href="http://twitter.com/share?url=http://is.gd/2LVtL1&text=Je viens de faire "+score+" points sur le jeu Doodle Jump en HTML5!&via=Forums_Mediabox&related=julienchauveau";var t=document.getElementById("fbBtn");t.href="http://facebook.com/sharer.php?s=100&p[url]=http://julienchauveau.com/labs/doodlejump/&p[title]=Je viens de faire "+score+" points sur le jeu Doodle Jump !&p[summary]=Pouvez-vous me battre dans cette version incroyable de Doodle Jump créé en HTML5 ?"}}function f(){n();s();i();r();player.draw();base.draw();u()}var e="left",t=0;firstRun=!1;menuLoop=function(){return};animloop=function(){f();requestAnimFrame(animloop)};animloop();hideMenu();showScore()}function reset(){hideGoMenu();showScore();player.isDead=!1;flag=0;position=0;score=0;base=new Base;player=new Player;Spring=new spring;platform_broken_substitute=new Platform_broken_substitute;platforms=[];for(var e=0;e<platformCount;e++)platforms.push(new Platform)}function hideMenu(){var e=document.getElementById("mainMenu");e.style.zIndex=-1}function showGoMenu(){var e=document.getElementById("gameOverMenu");e.style.zIndex=1;e.style.visibility="visible";var t=document.getElementById("go_score");t.innerHTML="Vous avez obtenu "+score+" points !"}function hideGoMenu(){var e=document.getElementById("gameOverMenu");e.style.zIndex=-1;e.style.visibility="hidden"}function showScore(){var e=document.getElementById("scoreBoard");e.style.zIndex=1}function hideScore(){var e=document.getElementById("scoreBoard");e.style.zIndex=-1}function playerJump(){player.y+=player.vy;player.vy+=gravity;player.vy>0&&player.x+15<260&&player.x+player.width-15>155&&player.y+player.height>475&&player.y+player.height<500&&player.jump();if(dir=="left"){player.dir="left";player.vy<-7&&player.vy>-15&&(player.dir="left_land")}else if(dir=="right"){player.dir="right";player.vy<-7&&player.vy>-15&&(player.dir="right_land")}document.onkeydown=function(e){var t=e.keyCode;if(t==37){dir="left";player.isMovingLeft=!0}else if(t==39){dir="right";player.isMovingRight=!0}if(t==32)if(firstRun===!0){init();firstRun=!1}else reset()};document.onkeyup=function(e){var t=e.keyCode;if(t==37){dir="left";player.isMovingLeft=!1}else if(t==39){dir="right";player.isMovingRight=!1}};if(player.isMovingLeft===!0){player.x+=player.vx;player.vx-=.15}else{player.x+=player.vx;player.vx<0&&(player.vx+=.1)}if(player.isMovingRight===!0){player.x+=player.vx;player.vx+=.15}else{player.x+=player.vx;player.vx>0&&(player.vx-=.1)}player.y+player.height>base.y&&base.y<height&&player.jump();player.x>width?player.x=0-player.width:player.x<0-player.width&&(player.x=width);player.draw()}function update(){ctx.clearRect(0,0,width,height);playerJump()}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),width=422,height=552;canvas.width=width;canvas.height=height;var platforms=[],image=document.getElementById("sprite"),player,platformCount=10,position=0,gravity=.2,animloop,flag=0,menuloop,broken=0,dir,score=0,firstRun=!0,Base=function(){this.height=5;this.width=width;this.cx=0;this.cy=614;this.cwidth=100;this.cheight=5;this.moved=0;this.x=0;this.y=height-this.height;this.draw=function(){try{ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(e){}}},base=new Base,Player=function(){this.vy=11;this.vx=0;this.isMovingLeft=!1;this.isMovingRight=!1;this.isDead=!1;this.width=55;this.height=40;this.cx=0;this.cy=0;this.cwidth=110;this.cheight=80;this.dir="left";this.x=width/2-this.width/2;this.y=height;this.draw=function(){try{this.dir=="right"?this.cy=121:this.dir=="left"?this.cy=201:this.dir=="right_land"?this.cy=289:this.dir=="left_land"&&(this.cy=371);ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(e){}};this.jump=function(){this.vy=-8};this.jumpHigh=function(){this.vy=-16}};player=new Player;for(var i=0;i<platformCount;i++)platforms.push(new Platform);var Platform_broken_substitute=function(){this.height=30;this.width=70;this.x=0;this.y=0;this.cx=0;this.cy=554;this.cwidth=105;this.cheight=60;this.appearance=!1;this.draw=function(){try{if(this.appearance!==!0)return;ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(e){}}},platform_broken_substitute=new Platform_broken_substitute,spring=function(){this.x=0;this.y=0;this.width=26;this.height=30;this.cx=0;this.cy=0;this.cwidth=45;this.cheight=53;this.state=0;this.draw=function(){try{this.state===0?this.cy=445:this.state==1&&(this.cy=501);ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(e){}}},Spring=new spring;menuLoop=function(){update();requestAnimFrame(menuLoop)};menuLoop();